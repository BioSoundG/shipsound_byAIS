# 開発ガイドラインとチェックリスト

このドキュメントは、コード修正や開発を行う際の標準的な手順とチェックリストを提供します。開発作業を始める前に、まずこのガイドラインを確認し、次に`Cases_of_caution.md`を参照してエッジケースや過去の失敗事例を確認することをお勧めします。

## 開発ワークフロー

1. **開発準備**
   - このガイドライン（development_guidelines.md）を読み、修正の基準を明確にする
   - 過去の事例集（Cases_of_caution.md）を参照し、エッジケースや注意点を確認する
   - 上記の情報を踏まえて開発計画を立てる

2. **開発実施**
   - 以下の「コード修正の基本手順」に従って修正を行う
   - チェックリストを活用して各段階で必要な確認を行う
   - 開発中に遭遇した課題や問題点をメモしておく（後でCases_of_caution.mdに追加するため）

3. **レビューと文書化**
   - 修正内容を記録し、**必ず**Cases_of_caution.mdに新しい注意点や学びを追加する
   - 開発中に躓いた点、見つけた解決策、次回同様の開発で有用なポイントを詳細に記録する
   - 特に最適化手法やパフォーマンス改善アプローチを詳細に文書化する
   - README.mdなど関連するドキュメントを更新する

## コード修正の基本手順

1. **問題の理解**
   - エラーメッセージや動作の問題点を正確に把握する
   - 関連するコードを特定し、その構造と動作を理解する
   - 関連ファイル間の依存関係を確認する

2. **変更計画の作成**
   - 修正するコードの範囲を決定する
   - 影響を受ける可能性のある他のコード部分を特定する
   - 変更によって生じる可能性のある副作用を考慮する
   - パフォーマンスやメモリ使用量への影響を評価する

3. **コード修正の実施**
   - 一度に1つの問題に焦点を当てる
   - コードの一貫性と可読性を維持する
   - 変更内容を明確にコメントする（必要に応じて）
   - 躓いた点や特に注意した点を記録しておく
   - パフォーマンス最適化を行った場合は、その手法と効果を記録する

4. **テスト**
   - 単体テストを実行して変更が正しく機能するか確認する
   - 統合テストを実行して他の機能への影響がないか確認する
   - エッジケースや特殊な状況でのテストも実施する
   - パフォーマンステストを実施し、最適化の効果を測定する
   - テスト中に発見した予期しない動作や問題点を記録する

5. **レビューと文書化**
   - 変更内容を自己レビューする
   - 必要に応じてドキュメントを更新する
   - 変更の概要とその理由を記録する
   - 開発プロセスで得た知見をCases_of_caution.mdに追加する
   - 最適化アプローチを詳細に記録する
   - README.mdの更新:
     - 機能の追加や重要な変更がある場合は、README.mdを更新する
     - ユーザー向けの新機能の説明や変更点を明確に記述する
     - インストール手順や使用方法に変更がある場合は必ず更新する
     - スクリーンショットや例を追加して理解を促進する

## コード修正時のチェックリスト

### 修正前
- [ ] バグやタスクの内容を完全に理解したか
- [ ] 関連するコードの全体像を把握したか
- [ ] 修正によって影響を受ける可能性のある他のコード部分を特定したか
- [ ] テスト計画を立てたか
- [ ] パフォーマンスの基準測定を行ったか（最適化の場合）

### 修正中
- [ ] コードスタイルが既存のコードに合わせているか
- [ ] 変数名や関数名が意味を明確に表しているか
- [ ] エラー処理が適切に行われているか
- [ ] パフォーマンスへの影響を考慮したか
- [ ] メモリ使用量の管理は適切か
- [ ] コードの重複を避けているか
- [ ] 躓いた点や問題点をメモしているか

### 修正後
- [ ] 単体テストは通過するか
- [ ] 統合テストは通過するか
- [ ] エッジケースでも正しく動作するか
- [ ] 最適化の効果を測定し記録したか（該当する場合）
- [ ] コードは読みやすく、維持しやすいか
- [ ] ドキュメントは更新されたか
- [ ] Cases_of_caution.mdに開発での学びや注意点を追加したか
- [ ] 最適化アプローチを詳細に文書化したか（該当する場合）

## データ処理に関する特別な注意事項

### データフォーマット
- [ ] データの型が適切に処理されているか（特にPandasのDataFrameやSeries）
- [ ] 欠損値や異常値の処理が適切か
- [ ] 日時データのフォーマットは一貫しているか

### ファイル操作
- [ ] ファイルパスの処理はOS間で互換性があるか
- [ ] ファイルの読み書きの例外処理は適切か
- [ ] 一時ファイルは適切に管理・削除されているか
- [ ] 大きなファイルの処理はメモリ効率が良いか

### メタデータの処理
- [ ] TOMLファイルのフォーマットは仕様に準拠しているか
- [ ] 日時や時間間隔の表示形式は人間が読みやすいか
- [ ] 必須フィールドがすべて含まれているか

## テスト戦略

### 単体テスト
- [ ] 各関数の入力と出力の境界値テスト
- [ ] 各関数の一般的なケースのテスト
- [ ] 例外が適切に発生するケースのテスト

### 統合テスト
- [ ] 複数のコンポーネントが連携する場合のテスト
- [ ] データの流れ全体を通したテスト
- [ ] 実際のユースケースに基づいたテスト

### エッジケース
- [ ] 欠損データや異常データの処理のテスト
- [ ] 極端な値や境界条件でのテスト
- [ ] リソース制約（メモリ、ディスク容量など）下でのテスト

### パフォーマンステスト
- [ ] 処理時間の計測と比較
- [ ] メモリ使用量のモニタリング
- [ ] 大規模データセットでの動作検証

## プロジェクト固有の注意事項

### オーディオ処理
- [ ] WAVファイルの読み書きの正確性
- [ ] サンプルレートの一貫性
- [ ] 切り出し位置の正確性
- [ ] 大きなオーディオファイルの効率的な処理

### 座標データの処理
- [ ] 緯度経度の計算の正確性
- [ ] 距離計算のアルゴリズムの正確性
- [ ] 座標系の一貫性

### AISデータの処理
- [ ] MMSIやIMOなどの識別子の一貫性
- [ ] 時間順のデータの適切な補間
- [ ] 速度や方向などの計算の正確性
- [ ] 大量のAISデータの効率的な処理方法

### 可視化機能
- [ ] スペクトログラム生成の効率性
- [ ] メモリ使用量の最適化
- [ ] 描画処理の最適化

## 可視化機能の開発ガイドライン

### メモリ使用量の最適化
- [ ] 大きなデータセットの処理時は、データのダウンサンプリングを検討
- [ ] 不要なデータの保持を避け、適切なタイミングでメモリを解放
- [ ] 画像生成時の解像度と品質のバランスを考慮
- [ ] メモリリークを防ぐため、`plt.close()`を適切に使用

### 描画処理の効率化
- [ ] 複数のプロット要素を一度に描画する際は、バッチ処理を活用
- [ ] 不要な再描画を避けるため、適切なタイミングで`plt.close()`を実行
- [ ] 大きな画像の生成時は、DPIを調整してファイルサイズを最適化
- [ ] 描画処理のパフォーマンスを定期的に測定

### データ表示形式の最適化
- [ ] 時間軸の表示は実際の時刻（HH:MM:SS形式）を使用し、ユーザーの理解を促進
- [ ] 軸ラベルの回転や配置を適切に調整し、読みやすさを確保
- [ ] ティックの数や間隔を調整し、表示情報量と読みやすさのバランスを取る
- [ ] 色やフォントなどの視覚要素を一貫して使用し、情報の解釈を容易にする
- [ ] データの特性に応じた単位や表示形式（対数スケールなど）を選択

### テストケースの作成方法
- [ ] エッジケース（空のデータ、極端な値など）のテストを追加
- [ ] パフォーマンステストを実施し、処理時間とメモリ使用量を計測
- [ ] テスト結果の自動検証を実装し、品質を担保
- [ ] テストケースの実行時間を最適化

## テストケースの作成ガイドライン

### エッジケースのテスト方法
- [ ] 空のデータフレームでの動作確認
- [ ] 極端な座標値での動作確認
- [ ] NaN値や無限大の値が含まれる場合の処理確認
- [ ] 異常な入力値に対するエラーハンドリングの確認

### パフォーマンステストの実施方法
- [ ] 大きなデータセットでの処理時間計測
- [ ] メモリ使用量のモニタリング
- [ ] 並列処理の効果測定
- [ ] パフォーマンスのベンチマーク設定

### テスト結果の検証方法
- [ ] 生成された画像の基本的なプロパティの確認
- [ ] 期待される要素の存在確認
- [ ] パフォーマンス指標の検証
- [ ] テスト結果の自動レポート生成

## ドキュメント作成・更新ガイドライン

### README.md
- [ ] プロジェクトの概要は明確か
- [ ] インストール手順は最新かつ正確か
- [ ] 使用方法や例が具体的に示されているか
- [ ] 新機能や変更点が記載されているか
- [ ] 依存関係やシステム要件が明記されているか

### コードドキュメント
- [ ] 関数やクラスに適切なドキュメントコメントがあるか
- [ ] パラメータと戻り値の説明が明確か
- [ ] 複雑なロジックには説明コメントが追加されているか
- [ ] 既知の制限事項や注意点が記載されているか
- [ ] 最適化手法や特殊なアルゴリズムの説明が含まれているか

### 変更履歴
- [ ] 変更内容が変更履歴（CHANGELOG.mdなど）に記録されているか
- [ ] バージョン番号が適切に更新されているか
- [ ] 変更の種類（機能追加、バグ修正、非互換変更など）が明記されているか
- [ ] パフォーマンス改善の内容と効果が記載されているか

## Cases_of_cautionの更新ガイドライン

### 更新のタイミング
- **必ず**各開発タスク完了後にCases_of_caution.mdを更新する
- 大きな機能追加や複雑なバグ修正を行った後は特に詳細に記録する
- パフォーマンス最適化や効率化を実施した後は必ず実装アプローチを記録する
- チームの他のメンバーが参考にできるように具体的かつ明確に記述する

### 記録すべき内容
- 開発中に遭遇した具体的な問題とその解決策
- 特殊なエッジケースやその対処方法
- パフォーマンス最適化のためのテクニック
  - メモリ使用量削減手法
  - 処理速度向上手法
  - リソース管理の改善方法
- テスト時に見つかった予期しない動作
- ライブラリやフレームワークの特定のバージョンに関連する問題
- 将来の開発者が同じ問題で躓かないための推奨事項

### 記録の構造
- タイトルは明確で検索しやすいものにする
- 問題の概要、実施した対応、学んだ教訓の3部構成で記述する
- 最適化記録の場合は、課題、実施した最適化、コード例、効果測定、将来の改善点を含める
- 可能な限りコードのサンプルやエラーメッセージを含める
- 関連するファイルや関数への参照を明記する
- 検証項目のチェックリストを含め、実装の正確性を確認できるようにする

## テストファーストアプローチと修正手順

### テストと実装の関係性

1. **テストコードの優先度**
   - テストコードは設計の意図を表現する重要なドキュメント
   - テストの期待値は、インターフェースの仕様を定義する
   - 既存のテストが正しい使用方法を示している場合、実装をテストに合わせて修正する

2. **修正の優先順位**
   - テストコードが正しい使用方法を示している場合:
     1. テストコードの意図を理解
     2. 実装をテストに合わせて修正
   - テストコードが不適切な場合:
     1. テストコードを修正
     2. 実装を修正
     3. 新しいテストを追加（必要な場合）

3. **修正手順のベストプラクティス**
   - 修正前に既存のテストの意図を理解する
   - テストが示す使用方法が適切かを評価する
   - 実装とテストのどちらを修正するか判断する
   - 修正後は必ずテストを実行する

### 具体的な手順

1. **設計変更の検討**
   ```
   - 問題点の特定
   - 既存のテストケースの確認
   - 設計変更の必要性の判断
   ```

2. **修正方針の決定**
   ```
   - テストコードが正しい使用方法を示しているか確認
   - テストと実装のどちらを修正するか決定
   - 修正による影響範囲の評価
   ```

3. **修正の実施**
   ```
   - テストコードの修正（必要な場合）
   - 実装コードの修正
   - テストの実行と確認
   ```

4. **ドキュメントの更新**
   ```
   - 修正内容の記録
   - 設計変更の理由の文書化
   - 新しい使用方法の説明の追加
   ```

### チェックリスト

- [ ] 既存のテストの意図を理解したか
- [ ] テストと実装のどちらを修正するか判断したか
- [ ] 修正による影響範囲を評価したか
- [ ] テストを実行して確認したか
- [ ] ドキュメントを更新したか

---

これらのガイドラインとチェックリストに従うことで、コード修正のプロセスをより体系的かつ効率的に進めることができます。また、潜在的な問題を早期に発見し、高品質なコードを維持することができます。

## 関連ドキュメント

- [Cases_of_caution.md](./Cases_of_caution.md) - 過去の注意すべきケースとベストプラクティス集
  - エッジケースの事例
  - 過去の失敗と学んだ教訓
  - プロジェクト固有の実装ノウハウ 
  - 開発中に遭遇した問題と解決策
  - パフォーマンス最適化とその効果
  - メモリ管理の改善手法 